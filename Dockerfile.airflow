FROM apache/airflow:2.8.2-python3.11

USER airflow

ENV AIRFLOW_HOME=/opt/airflow

COPY requirements.txt /
RUN pip install --no-cache-dir "apache-airflow==${AIRFLOW_VERSION}" -r /requirements.txt


COPY init-airflow.sh /opt/airflow/init-airflow.sh

# Copy all project files
COPY data_fetcher /opt/airflow/data_fetcher/
COPY dags /opt/airflow/dags/
COPY README.md /opt/airflow/README.md
COPY pyproject.toml /opt/airflow/pyproject.toml

RUN pip install --no-cache-dir .

WORKDIR /opt/airflow
